# ETL 

![image-20210801123053715](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210801123053715.png)

数据仓库应用

​      为什么企业需要数据仓库

​	 数据仓库有哪些特点：面向主题、集成、相当稳定、反映历史变化。

​	 数据仓库有哪几种模型，有什么区别？

​		星型模型、雪花模型

​	 构建数据仓库的步骤是什么?

​		1.确定主题  2.确定量度(量值(数字类型)，KPI指标)  3.确定事实粒度  4.确定维度 5.创建事实表

PowerDesigner应用

​	 概念模型与物理模型有什么区别

​	 概念模型如何建立关系，物理模型如何生成主外键关系

​	 物理模型如何与数据库交互？



ETL在整个BI过程中所处的地位





## ETL概述

​		ETL即数据提取(Extract)、转换(Transform)、加载(Load)的过程，它是构建数据仓库的重要环节。

​	    ETL负责将分布的、异构数据源中的数据入关系数据、平面数据文件等取到临时中间层后进行清洗、转换、集成，最后加载到数据仓库或数据集市中，成为联机分析处理、数据挖掘的基础。

​		ETL是将业务系统的数据经过抽取、清洗转换之后加载到数据仓库的过程，目的是将企业中的分散、零乱、标准不统一的数据整合到一起，为企业的决策提供分析依据。ETL是BI项目重要的一个环节。通常情况下，在BI项目中ETL会花掉整个项目的1/3的时间，ETL设计的好坏直接关系到BI项目的成败。

​		ETL的设计分三部分：数据抽取、数据清洗转换、数据加载。在设计ETL的时候我们也是从这三部分出发。数据的抽取是从各个不同的数据源抽取到ODS(Operational Data Source，操作型数据存储)中---这个过程也可以做一些数据的清洗和转换，在抽取的过程中需要挑选不同的抽取方法，尽可能的提高ETL的运行效率。

​		ETL三个部分中，花费时间最长的是T(Transform清洗、转换)的部分，一般情况下这部分工作量是整个ETL的2/3。数据的加载一般在数据清洗完了之后直接写入DW(Data Warehouse，数据仓库)中去。

​		比如 ERP 2000多张表(零售主题、库存主题、财务主题、分销主题) 50多张表。

## ETL设计

一、数据的抽取

​		这一部分需要在调研阶段做大量的工作，首先要搞清楚数据是从几个业务系统中来，各个业务系统的数据库服务器运行什么DBMS，是否存在手工数据，手工数据量有多大，是否存在非结构化的数据等等，当收集完这些信息之后才可以进行数据抽取的设计。

1.对于与存放DW的数据库系统相同的数据源处理方法

​		这一类数据源在设计上比较容易。一般情况下，DBMS(SQL Server、MySQL)都会提供数据库链接功能，在DW数据库与服务器和原业务系统之间建立直接的链接关系就可以写Select语句直接访问。

2、对于与DW数据库系统不同的数据源的处理方法

​		对于这一类数据源，一般情况下也可以通过ODBC的方式建立数据库链接---如SQL Server和Oracle之间。如果不能建立数据库链接，可以有两种方式完成，一种是通过工具将数据源导出成.txt或者是.xls文件，然后再将这些源系统恩静导入到ODS中。另外一种方法是通过程序接口来完成。

3、对于文件类型数据源(.txt，.xls)，可以培训业务人员利用数据库工具将这些数据导入到指定的数据库，然后从指定的数据库中抽取。或者还可以借助工具实现，入SQL Server2008的SSIS服务的平面数据源和平面目标等组件导入ODS中去。

4、增量更新的问题

​		对于数据量大的系统，必须考虑增量抽取。一般情况下，业务系统会记录业务发生的时间，我们可以用来做增量的标志，每次抽取之前首先潘丹ODS中记录的最大时间，然后根据这个时间去业务系统取大于这个时间所有的记录。利用业务系统的时间戳，一般情况下，业务系统没有或者部分有时间戳。

二、数据的清洗转换

​	  一般情况下，数据仓库分为ODS、DW两部分。通常的做法是从业务系统到ODS做清洗，将脏数据和不完整的数据过滤掉，在从ODS到DW的过程中转换，进行一些业务规则的计算和聚合

1.数据清洗

​		数据清洗的任务是过滤那些不符合要求的数据，将过滤的结果交给业务主管部门，确认是否过滤掉还是由业务单位修正之后再进行抽取。不符合要求的数据主要是有不完整的数据、错误的数据、重复的数据三大类。

​		(1)不完整的数据：这一类数据主要是一些应该有的信息缺失，如供应商的名称、分公司的名称、客户的区域信息缺失、业务系统中主表与明细表不能匹配等。对于这一类的数据过滤出来，按缺失的内容分布写入不同Excel文件向客户提交，要求在规定时间内补全。补全后才写入数据仓库

​		(2)错误的数据：这一类错误产生的原因是业务系统不够健全，在接收输入后没有进行判断直接写入后台数据库造成的，比如数值数据输成全角数字字符、字符串数据后面有一个回车操作、日期格式不正确、日期越界等。这一类数据也要分类，对于类似于全角字符、数据前后有不可见的符的问题，只能通过写SQL语句的方式找出来，然后要求客户在业务系统修正之后抽取。日期格式不正确的或者是日期越界的这一类错误会导致ETL运行失败，这一类错误需要去业务系统数据库用SQL的方式挑出来，交给业务主管部门要求限期修正，修正之后再抽取。

2、数据转换

​		数据转换的任务主要是进行不一致数据转换、数据粒度的转换，以及一些商务规则的计算。

​		(1)不一致数据转换：这个过程是一个整合的过程，将不同业务系统的相同类型的数据统一，比如同一个供应商在结算系统的编码是XX0001，而在CRM中的编码是YY0001，这样在抽取过来之后统一转换成一个编码。

​		(2)数据粒度的转换：业务系统一般存储非常明细的数据，而数据仓库中数据是用来分析的，不需要非常明细的数据。一般情况下，会将业务系统数据按照数据仓库粒度进行聚合。

​		(3)商务规则的转换：不同的企业有不同的业务规则、不同的数据指标，这些指标有的时候不是简单的加加减减就能完成，这个时候需要在ETL中将这些数据指标计算好了之后存储在数据仓库中，以供分析使用。

​		ETL的实现有多种方法，常见的有三种。

​		(1)ETL工具(如SQL Server的SSIS服务、Informatic、DataStage等)实现

​		(2)SQL方式实现(编码实现)

​		(3)ETL工具和SQL相结合

​		前两种方法各有各的优缺点，借助工具可以快速的建立起ETL工程，屏蔽了复杂的编码任务，提高了速度，降低了难度，但是缺少灵活性。SQL的方法优点是灵活，提高ETL运行效率，但是编码复杂，对技术要求比较高。第三种是综合了前面两种的优点，会及大地提高ETL的开发速递和效率。

## ETL案例

以销售模块业务为例，分部讲解ETL的编码实现。

1、准备阶段

​	此阶段我们着重于了解数据源，需要确定以下问题：

​	1).数据源在哪？

​    2).数据源的格式如何？

​	3).数据源给出的频度？

​	4).数据源是以增量还是以全量给出

​	5).数据源的数据字典

2、分析阶段

​	此时我们已经将源数据导入数据库中，我们的精力要转移到业务范畴，我们需要了解：

​	需要实现哪些功能？

​	功能实现的数据口径为何？

3、实现阶段

​	通过SSIS来组织整个ETL过程

4、测试阶段

​	验证最终进入数据仓库的数据是否正确。

使用SSIS对数据进行ETL操作

SSIS关键元素的使用---包

包对象的主要功能是把其它SSIS对象组合成一个整体。首次创建包后，包是一个空对象，不能实现任何功能。若要向包添加功能，就需要向包添加对象，如控制流、数据流及相关的元素。包中含有一个带有数据流任务的控制流，而数据流任务中又包含数据流，数据流由源、转换和目标对象组成。

![image-20210802090301767](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210802090301767.png)

![image-20210802090249874](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210802090249874.png)

![image-20210802090428237](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210802090428237.png)

![image-20210802090715461](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210802090715461.png)

